<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>public</access>
        <active>true</active>
        <api_name>x_saico_eppersona.SSPKBUtils</api_name>
        <caller_access/>
        <client_callable>true</client_callable>
        <description>Utility methods for accessing knowlege content.</description>
        <name>SSPKBUtils</name>
        <script><![CDATA[var SSPKBUtils = Class.create();
SSPKBUtils.prototype = Object.extendsObject(global.AbstractAjaxProcessor, {

	getArticlesByCat: function(justPop) {
				
		var ga;
		if (justPop == 'Views') {
			ga = new GlideAggregate('kb_knowledge');
			ga.addEncodedQuery('kb_knowledge_base=3b65e7e1dbed7f40f42f32dc7c9619c1^sys_view_count>0');
			ga.addAggregate('SUM', 'sys_view_count');
			ga.groupBy('kb_category');
		} else if (justPop == 'Answers') {
			ga = new GlideAggregate('kb_knowledge');
			ga.addEncodedQuery('kb_knowledge_base=3b65e7e1dbed7f40f42f32dc7c9619c1');
			ga.addAggregate('COUNT');
			ga.groupBy('kb_category');
		} else if (justPop == 'Searches') {
			ga = new GlideAggregate('kb_use');
			ga.addEncodedQuery('article!=NULL^search_id!=NULL^search_id.search_term!=NULL^article.kb_knowledge_baseLIKEpublic');
			ga.addAggregate('COUNT');
			ga.groupBy('search_id.search_term');
		}
		
		
		ga.query();
		
		var rez = [];
		var kcatName = "";
		var kcatCount = 0;
		var kcatSys = "";
		var kSTerm = "";
		var useC = 0;

		while (ga.next()) {
			
			if (justPop == 'Views') {
				kcatName = ga.getDisplayValue('kb_category');			
				kcatSys = ga.getValue('kb_category');
				useC = parseInt(ga.getAggregate('SUM', 'sys_view_count'));
				if (useC > 1) {
					rez.push({
						"name" : kcatName,
						"weight" : useC,
						"katSys" : kcatSys
					});
				}
			} else if (justPop == 'Answers') {
				kcatName = ga.getDisplayValue('kb_category');			
				kcatSys = ga.getValue('kb_category');
				kcatCount = parseInt(ga.getAggregate('COUNT'));
				if (kcatCount > 45) {
					rez.push({
						"name" : kcatName,
						"weight" : kcatCount,
						"katSys" : kcatSys
					});
				}
			} else if (justPop == 'Searches') {
				kcatCount = parseInt(ga.getAggregate('COUNT'));
				if (kcatCount > 25) {
					rez.push({
						"name"   : ga.getDisplayValue('search_id.search_term'),
						"weight" : kcatCount,
						"katSys" : 5
					});
				}
			}
		}
		
		return rez;
	},
	
	
    type: 'SSPKBUtils'
});]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>admindavid</sys_created_by>
        <sys_created_on>2020-07-14 15:10:08</sys_created_on>
        <sys_id>46ef36f4db8e981036d27e09af96190d</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>SSPKBUtils</sys_name>
        <sys_package display_value="PersonaPortal" source="x_saico_eppersona">d2c8b27cdb4e981036d27e09af961908</sys_package>
        <sys_policy>read</sys_policy>
        <sys_scope display_value="PersonaPortal">d2c8b27cdb4e981036d27e09af961908</sys_scope>
        <sys_update_name>sys_script_include_46ef36f4db8e981036d27e09af96190d</sys_update_name>
        <sys_updated_by>admindavid</sys_updated_by>
        <sys_updated_on>2020-07-14 15:10:08</sys_updated_on>
    </sys_script_include>
</record_update>
